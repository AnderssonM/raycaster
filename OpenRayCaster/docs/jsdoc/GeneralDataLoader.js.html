<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Loaders/GeneralDataLoader.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: Loaders/GeneralDataLoader.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 *  A class for loading data through XMLHttpRequests
 * @author Martin Andersson, V.I.C, 2015. All rights reserved
 * @constructor
 * 
 */
function GeneralDataLoader() {
   console.log('New General  Loader::');
};

GeneralDataLoader.prototype = {
    id: "GeneralLoader",
    url: "",
    minimumResponseSize: 0,
    numRetries: 0,
    _failedRetries: 0,
    responseType: 'arraybuffer',
    asynchronous: true,
    /**
     * loadURL, loads data from url
     * @public
     * @param {string} url the URL to load
     * @param {lasttime} datetime check if updated since lastTime
     */
    loadURL: function(url, lastTime) {
        // create request object.
        this.request = new XMLHttpRequest();
        // set callback
        this.request.onreadystatechange = this.update.bind(this);
        // make request to get the file.
        this.url = url;
        this.request.open('GET', url, this.asynchronous);
        // specify the response type to 'arraybuffer'.
        if (this.asynchronous) {
            this.request.responseType = this.responseType;
        }
        // set 'last modified' time to UNIX time = '0'.
        this.request.setRequestHeader('Pragma', 'no-cache');
        this.request.setRequestHeader('Cache-Control', 'no-cache');
        //req.setRequestHeader("Expires", "Thu, 01 Jun 1970 00:00:00 GMT");

        if (lastTime === void 0) {
            this.request.setRequestHeader("If-Modified-Since", "Thu, 01 Jun 1970 00:00:00 GMT");
        }
        else {
            this.request.setRequestHeader("If-Modified-Since", lastTime.toGMTString());
        }

        // send the request.
        this.request.send();
    },
    /**
     * reload, reloads the data
     * @private 
     * @returns {undefined}
     */
    reload: function()
    {
        console.log("GeneralDataLoader:reload:" + this.url);
        this._failedRetries += 1;
        if (this._failedRetries &lt;= this.numRetries) {
            this.loadURL(this.url,0);
        }
        else {
            console.error("Load failed ( after  " + this._failedRetries + " retries).");
            this.onError();
        }
    },
    /**
     * update  Ready state change eventhandler 
     * @private
     *
     */
    update: function() {

        if (this.request.readyState === this.request.DONE) {
            if (this.request.status === 200 && this.request.response) {
                if (this.request.response.byteLength &lt; this.minimumResponseSize || this.minimumResponseSize === 0) {
                    this.done(this.request.response);
                }
                else {
                    console.error("GeneralDataLoader: Request loaded, but response data size too small");
                }
            }
            else if (this.request.status === 304) {     // Not modified
                this.done(this.request.response);
            }
            else {
                console.error("GeneralDataLoader: ERROR", this.request.status);
                this.reload();
            }
        }
        else {
         //   console.log("GeneralDataLoader: STATUS", this.url);
        }
    },
    /**
     * done Callback for loadcomplete , override in caller to receive the request
     * response.
     * @callback GeneralDataLoader~done
     * @param {Object} r Request response
     **/
    done: function(r) {
        console.log("GenrealDataLoader: Request success for ", this.url);
    }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-dependency.html">dependency</a></li></ul><h3>Classes</h3><ul><li><a href="CameraCrew.html">CameraCrew</a></li><li><a href="ColorMap.html">ColorMap</a></li><li><a href="GeneralDataLoader.html">GeneralDataLoader</a></li><li><a href="leaf.html">leaf</a></li><li><a href="NativeImageLoader.html">NativeImageLoader</a></li><li><a href="OpenRayCaster.html">OpenRayCaster</a></li><li><a href="OpenVolumeData.html">OpenVolumeData</a></li><li><a href="PointDataLoader.html">PointDataLoader</a></li><li><a href="RayTracingPass.html">RayTracingPass</a></li><li><a href="RenderPass.html">RenderPass</a></li><li><a href="TestHarness.html">TestHarness</a></li><li><a href="THREE.OrbitControls.html">OrbitControls</a></li><li><a href="VolDataLoader.html">VolDataLoader</a></li><li><a href="VolumeEgressCoordinatePass.html">VolumeEgressCoordinatePass</a></li><li><a href="VolumeGeometry.html">VolumeGeometry</a></li><li><a href="VolumeIngressCoordinatePass.html">VolumeIngressCoordinatePass</a></li></ul><h3>Namespaces</h3><ul><li><a href="Colormaps.html">Colormaps</a></li><li><a href="MissingMath.html">MissingMath</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Tue Sep 20 2016 13:34:34 GMT+0900 (JST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
